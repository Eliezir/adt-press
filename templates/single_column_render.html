{% set ns = namespace(image_count=0) %}
{% for part in section.part_ids %}
    {% if part.startswith("img_") %}
        {% set ns.image_count = ns.image_count + 1 %}
    {% endif %}
{% endfor %}
{% set is_image_only = section.part_ids|length > 0 and ns.image_count == section.part_ids|length %}
<div class="container content mx-auto w-full min-h-screen {% if is_image_only %}p-0{% else %}px-8 py-8{% endif %} flex items-center justify-center" id="content" style="background-color: {{ section.background_color }};">
    <section id="simple-main" role="article" data-section-type="{{ section.section_type.name }}" data-id="{{ section.section_id }}" {% if section.explanation_id %}data-eli5-id="{{ section.explanation_id }}"{% endif %}>
        <div class="flex flex-col lg:flex-row {% if is_image_only %}px-0{% else %}px-8{% endif %} items-center max-w-none w-full">
                    <!-- Single column layout for image-only or text-only pages -->
                    <div class="basis-full flex flex-col {% if is_image_only %}p-0{% else %}p-4{% endif %}" style="color: {{ section.text_color }};">
                        {% for part in section.part_ids %}
                        {% if images[part] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ part }}" style="object-fit: contain;
                        {% if is_image_only %}
                        max-height: 90vh;
                        {% else %}
                        max-height: 80vh;
                        {% endif %}
                        "></img>
                        {% else %}                        
                        <!-- Calculate total text length for single column text -->
                        {% set total_text_length = 0 %}
                        {% for text_part in groups[part].texts %}
                            {% set total_text_length = total_text_length + text_part.text|length %}
                        {% endfor %}
                        
                        <!-- Use smaller text if total text length exceeds 300 characters -->
                        {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}
                        
                        {% with line_style = "inline" %}
                        {% if groups[part].group_type in ["stanza", "list", "heading"] %}                            
                        {% set line_style = "block" %}
                        {% endif %}

                        {% for text in groups[part].texts %}
                            {% if text.text_type in ['book_title', 'chapter_title'] %}
                            <h1 class="mb-6 w-full max-w-4xl font-bold text-center text-4xl" data-id="{{ text.text_id }}">{{ text.text }}</h1>
                            {% elif text.text_type == 'section_heading' %}
                            <h2 class="mb-6 w-full max-w-4xl font-bold text-center text-2xl" data-id="{{ text.text_id }}">{{ text.text }}</h2>
                            {% elif text.text_type == 'book_subtitle' %}
                            <h3 class="mb-6 w-full max-w-4xl font-semibold text-center text-lg" data-id="{{ text.text_id }}">{{ text.text }}</h3>
                            {% else %}
                            <span class="mb-8 {{ text_size_class }} {{ line_style }} leading-relaxed text-center font-normal max-w-4xl" data-id="{{ text.text_id }}">{{ text.text }}</span>
                            {% endif %}
                        {% endfor %}
                        {% endwith %}
                        {% endif %}
                        {% endfor %}
                    </div>
        </div>
    </section>
</div>